## 修改后特性快速入门

### 1 `Json`

原库使用`Transient`来控制是否进行序列化,但是这个注解还有别的用途,所以我们需要单独的注解来完成更加精细的控制;

```kotlin
data class Demo(
  @Json(ignore=true)
  var name:String
)
```

`@Json(serialize = true,deserialize = true)`

`serialize`: 是否序列化: 默认true
`deserialize`: 是否反序列化: 默认true

### 2 val 成员变量 默认支持序列化(不支持反序列化)

如果我们的代码这样写:
```kotlin
data class Demo(
  var name:String
){
  val age:Int
  val age2:Int
      get() {
        return 10
      }

}
```

`age`和`age2` 字段是不支持序列化到json字符串的; 现已支持,无需配置;

如果不需要序列化,加上 `Json(ignore=true)` 注解即可;

### 2.1 关于 非构造函数中的 var 反序列化说明

**情况1: 名字相同**

```kotlin
class Demo(
  name:String
){
   var name:String = name+"1234"
}
```

此种情况下, 反序列话 走构造函数: 如果json name = "666" , 那么 最终的值为 "6661234"

**情况2: 名字不同**

class Demo(
  name:String
){
   var name2:String = name+"1234"
}

如果json中同事存在name和name2, 那么最终name2的值是json中的, 如果想要避免这种情况, 可以使用 `@Json(ignore=true)` 标记name2, 使其不进行反序列化


### 3 JsonObject,JsonArray 和 MJsonObject,MJsonArray

原库并没有提供 类似于 `fastjson` 的`JsonObject`;

这里有两种选择, 一个是使用 安卓自带的, 但是不支持 `Serilizable` 序列化;
还有就是使用 本库提供的 `MJsonObject,MJsonArray` ,别名 `JsonObject,JsonArray`, 已实现 `Serilizable` 接口;

### 4 Moshi 增加全局配置

```
class Moshi{
  /**
   * 全局序列化配置
   * @param lenient 是否宽容： 对非标准json name ，默认true
   * @param failOnUnknown 未知 json name 是否失败，默认false
   * @param serializeNulls null 是否序列化：默认false
   */
  public static void setGlobalConfig(
          boolean lenient,
          boolean failOnUnknown,
          boolean serializeNulls
  )
}
```

### 5 MoshiDefault 快捷方法

在项目合适的时机: 通常是启动时,可以初始化一个默认实例
```kotlin
Moshi.Builder()
  .add(KotlinJsonAdapterFactory())
  .addMJsonAdapter()
  .build()
  .setToDefault()
```

可以使用以下快捷方法:

```kotlin

//获取默认实例

moshiInstances

//反序列化

Demo::class.java.fromJson("{}")

Demo::class.java.toAdapter().fromJson("{}")

Map::class.java.newParameterizedType(String::class.java,Any::class.java)
  .fromJson<Map<String,Any?>>("{}")


"{}".toClass(Demo::class.java)

"{}".toType<Map<String,Any?>>(Map::class.java.newParameterizedType(String::class.java,Any::class.java))

"{}".toType<Map<String,Any?>>(Map::class.java.newParameterizedType(String::class.java,Any::class.java))

"{}".toMap(Any::class.java) //返回 Map<String,Any?>
"{}".toMap(String::class.java, Any::class.java) //返回 Map<String,Any?>
"{}".toClassList(String::class.java) //返回 List<String?>
"{}".toClassList(Any::class.java) //返回 List<Any?>


// 序列化

任何一个对象实例.toJsonString()

// 通过moshi 将一个类型转为另一个类型

demo.toOtherBean(Demo2::class.java)

```



## 关于遇到获取不到adapter 报错的说明

原库的设计理念是 标准DTO和常用数据格式, 但是我们总是会遇到各种使用到的, 不常见的数据类型;

比如 `DataLocal`, 如果一旦遇到,我们需要使用 原库 提供的 自定义adapter的方式 来完成 序列化和反序列化;

所以原库的扩展性特别强, 也要提醒大家, 不是所有对象都支持;

目前支持的数据类型有:

- 基本数据类型和String
- 自定义的实体类
- 集合: Map,List, 本库添加的几个集合支持
- 本库: 安卓自带的JsonObject 和 JsonArray
- 本库: MJsonObject MJsonArray

